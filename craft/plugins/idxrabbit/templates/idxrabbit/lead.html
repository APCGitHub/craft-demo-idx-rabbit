{% import "forms/basic.html" as forms %}

{% if id is defined and id %}
	{% set results = listing(id) %}

	{% if results['errors'] is defined and results.errors %}
		{% for error in results.errors %}
			{% if error['message'] is defined %}
				<div class="alert alert-danger">{{error.message}}</div>
			{% else %}
				<div class="alert alert-danger">An error occurred</div>
			{% endif %}
		{% endfor %}
	{% else %}
		{% set listing = results.data %}

		{% set agentProspect = getProspect() %}

		{% if agentProspect %}
			{% set agentProspect = agentProspect.data %}
		{% endif %}
		
		<div class="panel panel-default">
			{{leadForm({
				id: 'lead-form',
				class: 'form-horizontal',
				redirect: (redirect is defined and redirect) ? redirect : null,
				listingId: listing.ListingId,
				listingKey: listing.ListingKey,
				listingUrl: (listingUrl is defined and listingUrl) ? listingUrl : null
			})}}
				<div class="panel-body">
					<div class="form-group">
						<label class="control-label col-sm-2">Name:</label>
						<div class="col-sm-10">
							{{ forms.text({
								class: 'form-control',
								name: 'name',
								placeholder: 'John Doe',
								value: agentProspect.prospect ? agentProspect.prospect.name : null
							}) }}
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2">Email:</label>
						<div class="col-sm-10">
							{{ forms.text({
								class: 'form-control',
								name: 'email',
								type: 'email',
								placeholder: 'name@gmail.com',
								value: agentProspect.prospect ? agentProspect.prospect.email : null
							}) }}
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2">Phone:</label>
						<div class="col-sm-10">
							{{ forms.text({
								class: 'form-control',
								name: 'phone',
								placeholder: '(xxx) xxx-xxxx'
							}) }}
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2">Message:</label>
						<div class="col-sm-10">
							{{ forms.textarea({
								class: 'form-control',
								name: 'message',
								rows: 4,
								placeholder: 'Inquring about this listing...'
							}) }}
						</div>
					</div>
					<div class="form-group text-center">
						<button type="submit" class="btn btn-primary">Send</button>
					</div>
				</div>
			{{formClose()}}
		</div>
	{% endif %}
{% else %}
	<p>No id passed in.</p>
{% endif %}