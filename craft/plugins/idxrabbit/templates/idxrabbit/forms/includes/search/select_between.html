{% spaceless %}

{% if field is defined and field %}
	{% set key = random() %}
	{% set nameKey = "filter[" ~ field ~ "][" ~ key ~ "]" %}

	<input type="hidden" name="{{ nameKey }}[type]" value="between">

	{% if clause is defined and clause == 'or' %}
		<input type="hidden" name="{{ nameKey }}[clause]" value="or">
	{% endif %}

	{% set range = ((ranges is defined and ranges[0] is defined) ? ranges[0] : []) %}
	{% set value = ((values is defined and values[0] is defined) ? values[0] : null) %}
	{% set options = [] %}

	{#
	# Manually force the value array {range} into key => value pair
	# array so that we can pass to the select macro in a standard way
	#}
	{% if label is defined and label %}
		{% for v in range.values %}
			{% set modified = v | num_format(label) %}

			{% set options = options | merge([{
				value: v,
				label: modified
			}]) %}
		{% endfor %}
	{% else %}
		{% for v in range.values %}
			{% set options = options | merge([{
				label: v,
				value: v
			}]) %}
		{% endfor %}
	{% endif %}

	{% set options = options | merge([{label: 'any', value: ''}]) %}

	{# === WRAPPER ELEMENT === #}
	{% if wrapper is defined and wrapper[0] is defined %}
		{% if wrapper[0]['tag'] is defined and wrapper[0]['tag'] %}
			<{{- wrapper[0].tag | trim | lower }} 
				{% if wrapper[0]['class'] is defined %} class="{{ wrapper[0].class }}" {% endif %}
				{% if wrapper[0]['id'] is defined %} id="{{ wrapper[0].id }}"{% endif -%}>
		{% endif %}
	{% endif %}

	{% include "forms/includes/search/select.html" with {
		class: (class is defined and class[0] is defined ? class[0] : null),
		id: (id is defined and id[0] is defined ? id[0] : null),
		disabled: (disabled is defined and disabled[0] is defined ? disabled[0] : null),
		type: 'between',
		field: nameKey ~ "[start]",
		value: (value is defined and value ? value : null),
		options: options
	} only %}

	{% if wrapper is defined and wrapper[0] is defined %}
		{% if wrapper[0]['tag'] is defined %}
			</{{ wrapper[0].tag | trim | lower }}>
		{% endif %}
	{% endif %}

	{{ between | raw }}

	{% set range = ((ranges is defined and ranges[1] is defined) ? ranges[1] : []) %}
	{% set value = ((values is defined and values[1] is defined) ? values[1] : null) %}
	{% set options = [] %}

	{#
	# Manually force the value array {range} into key => value pair
	# array so that we can pass to the select macro in a standard way
	#}
	{% if label is defined and label %}
		{% for v in range.values %}
			{% set modified = v | num_format(label) %}

			{% set options = options | merge([{
				value: v,
				label: modified
			}]) %}
		{% endfor %}
	{% else %}
		{% for v in range.values %}
			{% set options = options | merge([{
				label: v,
				value: v
			}]) %}
		{% endfor %}
	{% endif %}

	{% set options = options | merge([{label: 'any', value: ''}]) %}

	{# === WRAPPER ELEMENT === #}
	{% if wrapper is defined %}
		{% if (wrapper | length) == 1 %}
			{% if wrapper[0]['tag'] is defined %}
				<{{ wrapper[0].tag | trim | lower }} 
					{% if wrapper[0]['class'] is defined %} class="{{ wrapper[0].class }}" {% endif %}
					{% if wrapper[0]['id'] is defined %} id="{{ wrapper[0].id }}"{% endif %}>
			{% endif %}
		{% elseif (wrapper | length) == 2 %}
			{% if wrapper[1]['tag'] is defined %}
				<{{ wrapper[1].tag | trim | lower }} 
					{% if wrapper[1]['class'] is defined %} class="{{ wrapper[1].class }}" {% endif %}'{% if wrapper[1]['id'] is defined %} id="{{ wrapper[1].id }}"{% endif %}'>
			{% endif %}
		{% endif %}
	{% endif %}

	{% include "forms/includes/search/select.html" with {
		class: (class is defined and class[1] is defined ? class[1] : null),
		id: (id is defined and id[1] is defined ? id[1] : null),
		disabled: (disabled is defined and disabled[1] is defined ? disabled[0] : null),
		type: 'between',
		field: nameKey ~ "[end]",
		value: (value is defined and value ? value : null),
		options: options
	} only %}
	
	{% if wrapper is defined %}
		{% if (wrapper | length) == 1 %}
			{% if wrapper[0]['tag'] is defined %}
				</{{ wrapper[0].tag | trim | lower }}>
			{% endif %}
		{% elseif (wrapper | length) == 2 %}
			{% if wrapper[1]['tag'] is defined %}
				</{{ wrapper[1].tag | trim | lower }}>
			{% endif %}
		{% endif %}
	{% endif %}
{% else %}
	<p>The {field} parameter is required</p>
{% endif %}

{% endspaceless %}